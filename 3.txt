@startuml
title Part 3: Complete Services, Repository, Database & Payment Architecture
skinparam linetype ortho
skinparam classAttributeIconSize 0
skinparam packageStyle rectangle
package "Service Layer"  {
    interface IPaymentService {
        + processTransaction(amount: double, type: String): boolean
    }  
    interface IAuthenticationService {
        + authenticate(email: String, password: String): AuthToken
        + register(userData: RegisterDTO): User
        + validateToken(token: String): boolean
        + logout(token: String): void
    }
    
    

    class PaymentService implements IPaymentService {
        - repo: IRepository
        - processor: IPaymentProcessor
        + processTransaction(amount: double, type: String): boolean
    }
    
    class NotificationService {
        - repository: IRepository
        + sendNotification(recipientID: String, message: String, type: String): void
    }
    
    class AccommodationService  {
        - repository: IRepository
        - paymentService: IPaymentService
        + bookHousing(studentID: String, accommodationID: String): void
    }
    
    class TransportService {
        - repository: IRepository
        - paymentService: IPaymentService
        + bookTransport(studentID: String, transportID: String): void
    }
    
    class MealService  {
        - repository: IRepository
        - paymentService: IPaymentService
        + selectMeal(studentID: String, mealType: String): void
    }
    
    class ClubService  {
        - repository: IRepository
        - paymentService: IPaymentService
        + chooseClub(studentID: String, clubID: String): void
    }
    
    class AuthenticationService implements IAuthenticationService {
        - userRepository: IRepository
        + authenticate(email: String, password: String): AuthToken
        + register(userData: RegisterDTO): User
        + validateToken(token: String): boolean
        + logout(token: String): void
    }
}

package "Repository Layer" #LightBlue {
    interface IRepository {
        + save(entity: Object): void
        + findById(id: String): Object
        + delete(id: String): void
        + update(entity: Object): void
        + findAll(): List<Object>
        + findByQuery(criteria: Map): List<Object>
    }
}

package "Database Layer" #LightGreen {
    interface IDatabaseAccess {
        + executeQuery(query: String): Object
        + connect(): void
        + disconnect(): void
        + beginTransaction(): void
        + commit(): void
        + rollback(): void
    }

    class DatabaseManager implements IDatabaseAccess {
        - static instance: DatabaseManager
        - connection: Connection
        - DatabaseManager()
        + static getInstance(): DatabaseManager
        + connect(): void
        + executeQuery(query: String): Object
    }

    class DatabaseProxy implements IDatabaseAccess {
        - realDatabase: DatabaseManager
        - accessLog: List<String>
        + connect(): void
        + executeQuery(query: String): Object
        - checkAccess(): boolean
        - logAccess(query: String): void
    }
    
    DatabaseProxy --> DatabaseManager : delegates to
    
}

package "Payment Processing Layer" #LightYellow {
    
    interface IPaymentProcessor {
        + processPayment(amount: double): boolean
        + refundPayment(transactionID: String): boolean
        + validatePayment(details: PaymentDetails): boolean
    }

    class VisaPayment implements IPaymentProcessor {
        - apiKey: String
        + processPayment(amount: double): boolean
        + refundPayment(transactionID: String): boolean
        + validatePayment(details: PaymentDetails): boolean
    }

    class VCPayment {
        + sendVirtualCoins(amt: double, cur: String, hash: String): boolean
        + verifyTransaction(hash: String): boolean
    }

    class VCAdapter extends VCPayment implements IPaymentProcessor {
        + processPayment(amount: double): boolean
        + refundPayment(transactionID: String): boolean
        + validatePayment(details: PaymentDetails): boolean
    }
}

package "Entities {
   class Payment {
        - paymentID: String
        - studentID: String
        - amount: double
        - date: Date
        - paymentMethod: String
        - status: String
    }
    
    class Accommodation {
        - accommodationID: String 
        - name: String 
        - location: String 
        - capacity: int 
        - pricePerNight: double
    } 
    
    class Transport {
        - transportID: String 
        - type: String 
        - schedule: String 
        - seatsAvailable: int
        - pricePerSeat: double
    } 
    
    class Meal {
        - mealID: String 
        - name: String 
        - type: String 
        - price: double 
    }
    
    class Club {
        - clubID: String 
        - name: String 
        - description: String 
        - membershipFee: double
    }
    
    class Notification {
        - notificationID: String 
        - recipientID: String 
        - message: String 
        - dateSent: Date 
        - isRead: boolean
    }
    
    class User {
        - userID: String
        - email: String
        - passwordHash: String
        - role: String
        - createdDate: Date
    }
    
    class Role {
        - roleID: String
        - roleName: String
        - permissions: List<String>
    }
}


PaymentService --> IRepository 
NotificationService --> IRepository 
AccommodationService --> IRepository 
TransportService --> IRepository 
MealService --> IRepository
ClubService --> IRepository 
AuthenticationService --> IRepository




AccommodationService --> IPaymentService
TransportService --> IPaymentService 
MealService --> IPaymentService 

IRepository --> IDatabaseAccess 

IRepository --> Payment : manages
IRepository --> Accommodation : manages
IRepository --> Transport : manages
IRepository --> Meal : manages
IRepository --> Club : manages
IRepository --> Notification : manages
IRepository --> User : manages
IRepository --> Role : manages

PaymentService --> IPaymentProcessor 

@enduml